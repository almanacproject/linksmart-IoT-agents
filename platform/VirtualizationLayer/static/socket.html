<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-GB" lang="en-GB">
<head>
<meta charset="UTF-8" />
<title>Socket.IO chat | ALMANAC</title>
<meta name="robots" content="noindex,nofollow" />
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font: 13px Helvetica, Arial; }
form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
#messages { list-style-type: none; margin: 0; padding: 0; }
#messages li { padding: 5px 10px; }
#messages li:nth-child(odd) { background: #eee; }
</style>
<script src="/socket.io/socket.io.js"></script>
<script>
var socket = io();

socket.on('chat', function(msg) {
		var messages = document.getElementById('messages'),
			li = document.createElement('li');
		if (messages) {
			li.textContent = msg;
			messages.appendChild(li);
		}
	});

socket.on('DM', function(msg) {
		var messages = document.getElementById('messages'),
			li = document.createElement('li');
		if (messages) {
			try {
				var json = JSON.parse(msg.body);
				li.textContent = 'Valid JSON: ' + JSON.stringify(json) + ' ; posted to: ' + msg.url + ' ; with headers: ' + JSON.stringify(msg.headers);
			} catch (e) {
				li.textContent = 'Invalid JSON: ' + msg.body + ' ; posted to: ' + msg.url;
			}
			messages.appendChild(li);
		}
	});

function chat(form) {
	socket.emit('chat', form.m.value);
	form.m.value = '';
	return false;
}
</script>
</head>

<body>
	<ul id="messages"></ul>
	<form action="" onsubmit="return chat(this);">
		<input id="m" autocomplete="off" />
		<button>Send</button>
	</form>
</body>
</html>
